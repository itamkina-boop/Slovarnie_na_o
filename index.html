
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–Ω–µ–∂–Ω—ã–π —Å–ø—Ä–∏–Ω—Ç–µ—Ä: –ì–ª–∞—Å–Ω—ã–µ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Montserrat:wght@700;800;900&display=swap" rel="stylesheet">
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ (–Ω–µ –º–µ–Ω—è–ª) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            touch-action: manipulation;
        }

        #game-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            height: 500px;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);
            background: #0f172a;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π... */
        
    </style>
</head>
<body>
    <div id="game-container">
        <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div id="loading-screen" class="screen">
            <div class="loader"></div>
            <h2 style="color: #ffffff; margin-top: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</h2>
            <p id="loading-progress" style="color: #94a3b8; margin-top: 10px; text-align: center; padding: 0 20px;">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞</p>
            <button id="skip-loading-btn" style="margin-top: 20px; background: #475569; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É</button>
        </div>

        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="start-screen" class="screen hidden">
            <div class="screen-content">
                <h1>–°–ù–ï–ñ–ù–´–ô –°–ü–†–ò–ù–¢–ï–†</h1>
                <p class="subtitle">–ü–æ–º–æ–≥–∏ —à–∫–æ–ª—å–Ω–∏–∫—É –¥–æ–±—Ä–∞—Ç—å—Å—è –¥–æ —à–∫–æ–ª—ã! –ü—Ä—ã–≥–∞–π —á–µ—Ä–µ–∑ —Å—É–≥—Ä–æ–±—ã –∏ –∑–∞–ø–æ–ª–Ω—è–π –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ –≤ —Å–ª–æ–≤–∞—Ö.</p>
                
                <div class="instructions">
                    <div class="instruction-item">
                        <div class="instruction-icon">üèÉ</div>
                        <span><strong>–ü–†–û–ë–ï–õ</strong> –∏–ª–∏ <strong>–¢–ê–ü</strong> ‚Äî –ø—Ä—ã–∂–æ–∫ —á–µ—Ä–µ–∑ —Å—É–≥—Ä–æ–±</span>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-icon">üìù</div>
                        <span>–ü—Ä–∏ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–∏ ‚Äî –∑–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ</span>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-icon">‚ù§Ô∏è</div>
                        <span>–£ —Ç–µ–±—è <strong>3 –∂–∏–∑–Ω–∏</strong>. –û—à–∏–±–∫–∞ = –ø–æ—Ç–µ—Ä—è –∂–∏–∑–Ω–∏</span>
                    </div>
                    <div class="instruction-item">
                        <div class="instruction-icon">üèÜ</div>
                        <span>–ü—Ä–æ–±–µ–≥–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –¥–∞–ª—å—à–µ –∏ –∑–∞–ø–æ–º–Ω–∏ –±–æ–ª—å—à–µ —Å–ª–æ–≤!</span>
                    </div>
                </div>
                
                <button id="start-btn" class="btn">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
                <p class="tap-to-start">–ü–ö: <strong>–ü–†–û–ë–ï–õ</strong> ‚Ä¢ –¢–ï–õ–ï–§–û–ù: <strong>–¢–ê–ü –ü–û –≠–ö–†–ê–ù–£</strong></p>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
        <canvas id="game-canvas"></canvas>
        
        <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã -->
        <div id="game-ui" class="game-ui hidden">
            <div class="lives-panel ui-panel">
                <span class="lives-count">–ñ–∏–∑–Ω–∏</span>
                <div class="life"></div>
                <div class="life"></div>
                <div class="life"></div>
            </div>
            
            <div class="distance-panel ui-panel">
                <div class="distance-icon">üìè</div>
                <span id="distance">0</span> –º–µ—Ç—Ä–æ–≤
            </div>
        </div>

        <!-- –û–∫–Ω–æ –∑–∞–¥–∞–Ω–∏—è -->
        <div id="task-overlay" class="task-overlay hidden">
            <div class="task-window">
                <div class="task-title">–ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ –≥–ª–∞—Å–Ω—ã–µ</div>
                <div id="task-word" class="task-word"></div>
                <div id="vowel-buttons" class="vowel-buttons"></div>
                <p style="color: #94a3b8; margin-top: 20px; font-size: 14px; text-align: center;">–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≥–ª–∞—Å–Ω—É—é</p>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω Game Over -->
        <div id="game-over-screen" class="screen hidden">
            <div class="screen-content">
                <div id="sad-character" class="sad-character"></div>
                <h2>–ò–ì–†–ê –ó–ê–í–ï–†–®–ï–ù–ê</h2>
                <div class="results">
                    <div class="result-item">
                        <span>–î–∏—Å—Ç–∞–Ω—Ü–∏—è:</span>
                        <span id="final-distance" class="result-value">0 –º</span>
                    </div>
                    <div class="result-item">
                        <span>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Å–ª–æ–≤:</span>
                        <span id="words-count" class="result-value">0</span>
                    </div>
                    <div class="result-item">
                        <span>–û—à–∏–±–æ–∫:</span>
                        <span id="mistakes-count" class="result-value">0</span>
                    </div>
                </div>
                <button id="restart-btn" class="btn">–ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
                <button id="menu-btn" class="btn btn-secondary">–í –ú–ï–ù–Æ</button>
                <p class="tap-to-start" style="margin-top: 20px;">–ù–∞–∂–º–∏ <strong>–õ–Æ–ë–£–Æ –¢–û–ß–ö–£ –ù–ê –≠–ö–†–ê–ù–ï</strong> –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞</p>
            </div>
        </div>
    </div>

    <script>
        // –°–ª–æ–≤–∞ –¥–ª—è –∏–≥—Ä—ã
        const wordList = {
            "–Ω–∞–≤_–∂–¥–µ–Ω–∏–µ": "–∏",
            "–Ω–∞—Å_–∫–æ–º—ã–µ": "–µ",
            "–Ω–µ–¥–æ—Å_–≥–∞–µ–º—ã–π": "—è",
            "–Ω_–≤–µ–ª–ª–∞": "–æ",
            "–æ–±_—è–Ω–∏–µ": "–∞",
            "–æ–±_—è—Ç–µ–ª—å–Ω—ã–π": "–∞",
            "–æ–±_—Ç–∞—Ç—å": "–∏",
            "–æ–±_—Ç–∞—Ç–µ–ª—å": "–∏",
            "–æ–±–Ω_—Ä—É–∂–∏—Ç—å": "–∞",
            "–æ–±_–Ω—è–Ω–∏–µ": "–æ",
            "–æ–±_–Ω—è—Ç–µ–ª—å–Ω—ã–π": "–æ",
            "–æ–±_—Ä–æ–Ω–∞": "–æ",
            "–æ–±_—Ä–æ–Ω—è—Ç—å": "–æ",
            "–æ–¥_–ª–µ—Ç—å": "–æ",
            "–æ–∑_—Ä–Ω–æ–π": "–æ",
            "–æ–∑_—Ä–Ω–∏—á–∞—Ç—å": "–æ",
            "–æ–∑_—Ä–Ω–∏–∫": "–æ",
            "–æ–ø_–∫—É–Ω": "–µ",
            "–æ–ø_–∫—É–Ω—Å–∫–∏–π": "–µ",
            "–æ–ø—Ç_–º–∏—Å—Ç": "–∏",
            "–æ–ø—Ç_–º–∏—Å—Ç–∏—á–Ω—ã–π": "–∏",
            "–æ–ø—Ç_–º–∏–∑–º": "–∏",
            "–æ—Ä_–Ω–∂_—Ä–µ—è": "–∞,–µ",
            "_—Ä–±–∏—Ç–∞": "–æ",
            "_—Ä–±–∏—Ç–∞–ª—å–Ω—ã–π": "–æ",
            "–æ—Ä–≥_–Ω–∏–∑–æ–≤–∞—Ç—å": "–∞",
            "–æ—Ä–≥_–Ω–∏–∑–∞—Ü–∏—è": "–∞",
            "–æ—Ä_–≥_–Ω–∞–ª—å–Ω—ã–π": "–∏,–∏",
            "–æ—Ä_–µ–Ω—Ç–∏—Ä": "–∏",
            "–æ—Ä_–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å": "–∏",
            "–æ—Ä_–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è": "–∏",
            "–æ—Ä_–µ–Ω—Ç–∞—Ü–∏—è": "–∏",
            "_—Ä–Ω–∞–º–µ–Ω—Ç": "–æ",
            "–æ—Å—Ç_—Ä–æ–∂–Ω—ã–π": "–æ",
            "–æ—Å—Ç_—Ä–æ–∂–Ω–æ—Å—Ç—å": "–æ",
            "–æ—Ñ_—Ü–µ—Ä": "–∏",
            "–æ—Ñ_—Ü–µ—Ä—Å–∫–∏–π": "–∏",
            "–æ—à_–ª–æ–º–∏—Ç—å": "–µ",
            "–æ—à_–ª–æ–º–∏—Ç–µ–ª—å–Ω—ã–π": "–µ",
            "–æ—à_–ª–æ–º–ª—ë–Ω–Ω—ã–π": "–µ"
        };

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let canvas, ctx;
        let gameActive = false;
        let gamePaused = false;
        let distance = 0;
        let speed = 3;
        let baseSpeed = 3;
        let maxSpeed = 10;
        let acceleration = 0.0001;
        let lives = 3;
        let score = 0;
        let mistakes = 0;
        let currentWord = '';
        let currentAnswer = '';
        let currentBlanks = [];
        let answeredLetters = 0;
        let snowflakes = [];
        let player, snowpiles = [];
        let buildings = [];
        let lastSnowpileTime = 0;
        let lastBuildingTime = 0;
        let snowpileInterval = 2000;
        let buildingInterval = 4000;

        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const images = {
            playerRun1: new Image(),
            playerRun2: new Image(),
            playerJump: new Image(),
            playerHit: new Image(),
            playerSad: new Image(),
            snowpile: new Image(),
            bgSky: new Image(),
            bgMountains: new Image(),
            bgGround: new Image(),
            building1: new Image(),
            building2: new Image(),
            building3: new Image()
        };

        // –°–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        let loadedImages = 0;
        let totalImages = Object.keys(images).length;
        let imagesLoaded = false;
        let loadingTimeout = null;

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const loadingScreen = document.getElementById('loading-screen');
        const loadingProgress = document.getElementById('loading-progress');
        const skipLoadingBtn = document.getElementById('skip-loading-btn');
        const startScreen = document.getElementById('start-screen');
        const gameUI = document.getElementById('game-ui');
        const taskOverlay = document.getElementById('task-overlay');
        const taskWordElement = document.getElementById('task-word');
        const vowelButtonsContainer = document.getElementById('vowel-buttons');
        const gameOverScreen = document.getElementById('game-over-screen');
        const sadCharacterElement = document.getElementById('sad-character');
        const distanceElement = document.getElementById('distance');
        const finalDistanceElement = document.getElementById('final-distance');
        const wordsCountElement = document.getElementById('words-count');
        const mistakesCountElement = document.getElementById('mistakes-count');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const menuBtn = document.getElementById('menu-btn');

        // –ì–ª–∞—Å–Ω—ã–µ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const vowels = ['–ê', '–ï', '–Å', '–ò', '–û', '–£', '–´', '–≠', '–Æ', '–Ø'];

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∏–≥—Ä—ã
        function forceStartGame() {
            console.log("–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã)");
            imagesLoaded = true;
            loadingScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            if (loadingTimeout) {
                clearTimeout(loadingTimeout);
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è –∑–¥–∞–Ω–∏–π
        class Building {
            constructor(image, x) {
                this.image = image;
                this.x = x;
                this.width = 200;
                this.height = 300;
                this.speed = speed * 0.3;
            }

            update() {
                if (gamePaused) return;
                this.x -= this.speed;
            }

            draw() {
                if (imagesLoaded && this.image.complete && this.image.naturalHeight !== 0) {
                    ctx.drawImage(this.image, this.x, 350 - this.height + 50, this.width, this.height);
                } else {
                    // Fallback –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
                    ctx.fillStyle = '#475569';
                    ctx.fillRect(this.x, 350 - this.height + 50, this.width, this.height);
                    
                    ctx.fillStyle = '#fbbf24';
                    for (let i = 0; i < 3; i++) {
                        for (let j = 0; j < 2; j++) {
                            ctx.fillRect(
                                this.x + 30 + i * 50,
                                350 - this.height + 100 + j * 60,
                                30,
                                40
                            );
                        }
                    }
                }
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        class Player {
            constructor() {
                this.x = 100;
                this.y = 250;
                this.width = 60;
                this.height = 100;
                this.jumpHeight = 150;
                this.jumpSpeed = 15;
                this.gravity = 0.8;
                this.isJumping = false;
                this.jumpVelocity = 0;
                this.groundY = 250;
                this.runFrame = 0;
                this.frameCounter = 0;
                this.hitTime = 0;
                this.isHit = false;
            }

            jump() {
                if (!this.isJumping && !this.isHit && !gamePaused) {
                    this.isJumping = true;
                    this.jumpVelocity = -this.jumpSpeed;
                    createJumpEffect(this.x + this.width/2, this.y + this.height);
                }
            }

            hit() {
                this.isHit = true;
                this.hitTime = Date.now();
            }

            update() {
                if (gamePaused) return;
                
                this.frameCounter++;
                if (this.frameCounter > 10) {
                    this.runFrame = this.runFrame === 0 ? 1 : 0;
                    this.frameCounter = 0;
                }

                if (this.isHit) {
                    if (Date.now() - this.hitTime > 1000) {
                        this.isHit = false;
                    }
                    return;
                }

                if (this.isJumping) {
                    this.y += this.jumpVelocity;
                    this.jumpVelocity += this.gravity;
                    
                    if (this.y > this.groundY) {
                        this.y = this.groundY;
                        this.isJumping = false;
                        createLandEffect(this.x + this.width/2, this.y + this.height);
                    }
                }
            }

            draw() {
                // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –¥–ª—è –Ω–∞—á–∞–ª–∞
                this.drawFallback();
            }

            drawFallback() {
                ctx.fillStyle = '#3b82f6';
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                ctx.fillStyle = '#fbbf24';
                ctx.beginPath();
                ctx.arc(this.x + this.width/2, this.y + 25, 25, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#1e40af';
                ctx.fillRect(this.x, this.y + 50, this.width, 50);
                
                ctx.fillStyle = '#1e293b';
                const legOffset = Math.sin(Date.now() / 100) * 10;
                ctx.fillRect(this.x + 15, this.y + 100, 10, 40 + legOffset);
                ctx.fillRect(this.x + 35, this.y + 100, 10, 40 - legOffset);
            }

            getBounds() {
                return {
                    x: this.x + 15,
                    y: this.y + 50,
                    width: this.width - 30,
                    height: this.height - 50
                };
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —Å—É–≥—Ä–æ–±–∞
        class Snowpile {
            constructor(x) {
                this.x = x;
                this.width = 80;
                this.height = 60;
                this.passed = false;
            }

            update() {
                if (gamePaused) return;
                this.x -= speed;
            }

            draw() {
                // –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –¥–ª—è –Ω–∞—á–∞–ª–∞
                this.drawFallback();
            }

            drawFallback() {
                ctx.fillStyle = '#ffffff';
                ctx.beginPath();
                ctx.ellipse(this.x + this.width/2, 310 - this.height/2, this.width/2, this.height/2, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.strokeStyle = '#e2e8f0';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                for (let i = 0; i < 3; i++) {
                    const sparkleX = this.x + 20 + i * 20;
                    const sparkleY = 290 + Math.sin(Date.now()/1000 + i) * 5;
                    ctx.beginPath();
                    ctx.arc(sparkleX, sparkleY, 4, 0, Math.PI * 2);
                    ctx.fill();
                }
            }

            getBounds() {
                return {
                    x: this.x + 10,
                    y: 310 - this.height,
                    width: this.width - 20,
                    height: this.height
                };
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function loadImages() {
            console.log("–ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...");
            
            // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è
            loadingTimeout = setTimeout(() => {
                console.log("–¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –∏—Å–ø–æ–ª—å–∑—É–µ–º fallback –≥—Ä–∞—Ñ–∏–∫—É");
                forceStartGame();
            }, 5000); // 5 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É
            
            // –°–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
            const imageFiles = [
                { key: 'playerRun1', src: 'player_run1.png' },
                { key: 'playerRun2', src: 'player_run2.png' },
                { key: 'playerJump', src: 'player_jump.png' },
                { key: 'playerHit', src: 'player_hit.png' },
                { key: 'playerSad', src: 'player_sad.png' },
                { key: 'snowpile', src: 'snowpile.png' },
                { key: 'bgSky', src: 'bg_sky.png' },
                { key: 'bgMountains', src: 'bg_mountains.png' },
                { key: 'bgGround', src: 'bg_ground.png' },
                { key: 'building1', src: 'building1.png' },
                { key: 'building2', src: 'building2.png' },
                { key: 'building3', src: 'building3.png' }
            ];
            
            // –°—á—ë—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            let loadedCount = 0;
            let errorCount = 0;
            
            // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            function updateProgress() {
                loadedCount++;
                loadingProgress.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${loadedCount}/${totalImages} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`;
                
                if (loadedCount + errorCount >= totalImages) {
                    console.log(`–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: ${loadedCount} —É—Å–ø–µ—à–Ω–æ, ${errorCount} —Å –æ—à–∏–±–∫–æ–π`);
                    if (loadingTimeout) {
                        clearTimeout(loadingTimeout);
                    }
                    setTimeout(() => {
                        loadingScreen.classList.add('hidden');
                        startScreen.classList.remove('hidden');
                        imagesLoaded = true;
                    }, 500);
                }
            }
            
            // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞–∂–¥–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            imageFiles.forEach(item => {
                const img = images[item.key];
                img.onload = updateProgress;
                img.onerror = function() {
                    console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å: ${item.src}`);
                    errorCount++;
                    updateProgress();
                };
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫
                img.src = item.src;
            });
        }

        // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
        function createJumpEffect(x, y) {
            for (let i = 0; i < 5; i++) {
                snowflakes.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 4,
                    vy: Math.random() * -3 - 2,
                    size: Math.random() * 3 + 2,
                    life: 30,
                    color: '#ffffff'
                });
            }
        }

        function createLandEffect(x, y) {
            for (let i = 0; i < 8; i++) {
                snowflakes.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 6,
                    vy: Math.random() * -2,
                    size: Math.random() * 4 + 3,
                    life: 40,
                    color: '#e2e8f0'
                });
            }
        }

        function createSnowfall() {
            snowflakes.push({
                x: Math.random() * canvas.width,
                y: 0,
                vx: (Math.random() - 0.5) * 0.5,
                vy: Math.random() * 2 + 1,
                size: Math.random() * 4 + 2,
                life: 200,
                color: 'rgba(255, 255, 255, 0.7)'
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...");
            
            canvas = document.getElementById('game-canvas');
            ctx = canvas.getContext('2d');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞–Ω–≤–∞—Å–∞
            canvas.width = 900;
            canvas.height = 500;
            
            player = new Player();
            snowpiles = [];
            buildings = [];
            lastSnowpileTime = 0;
            lastBuildingTime = 0;
            snowpileInterval = 2000;
            buildingInterval = 4000;
            
            createVowelButtons();
            setupEventListeners();
            
            // –ù–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            loadImages();
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–Ω–µ–≥–æ–ø–∞–¥
            for (let i = 0; i < 50; i++) {
                createSnowfall();
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª —Å—Ä–∞–∑—É
            requestAnimationFrame(gameLoop);
            
            console.log("–ò–≥—Ä–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –º–æ–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å!");
        }

        function createVowelButtons() {
            vowelButtonsContainer.innerHTML = '';
            vowels.forEach(vowel => {
                const button = document.createElement('div');
                button.className = 'vowel-btn no-select';
                button.textContent = vowel;
                button.onclick = () => handleVowelClick(vowel);
                vowelButtonsContainer.appendChild(button);
            });
        }

        function setupEventListeners() {
            console.log("–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π...");
            
            // –°—Ç–∞—Ä—Ç –ø–æ –∫–Ω–æ–ø–∫–µ
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', startGame);
            menuBtn.addEventListener('click', () => {
                gameOverScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            });
            
            // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
            skipLoadingBtn.addEventListener('click', forceStartGame);
            
            // –°—Ç–∞—Ä—Ç –ø–æ —Ç–∞–ø—É –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
            startScreen.addEventListener('click', function(e) {
                if (!e.target.closest('.btn')) {
                    startGame();
                }
            });
            
            gameOverScreen.addEventListener('click', function(e) {
                if (!e.target.closest('.btn')) {
                    startGame();
                }
            });
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä—ã–∂–∫–æ–º
            document.addEventListener('keydown', (e) => {
                if (e.code === 'Space') {
                    e.preventDefault();
                    if (gameActive && !gamePaused) {
                        player.jump();
                    } else if (startScreen.classList.contains('hidden') && 
                               !gameOverScreen.classList.contains('hidden')) {
                        startGame();
                    } else if (!gameActive) {
                        startGame();
                    }
                }
            });
            
            // –¢–∞–ø –¥–ª—è –ø—Ä—ã–∂–∫–∞
            function handleTap(e) {
                e.preventDefault();
                if (gameActive && !gamePaused) {
                    player.jump();
                }
            }
            
            canvas.addEventListener('touchstart', handleTap);
            canvas.addEventListener('click', handleTap);
            
            // –í–≤–æ–¥ –±—É–∫–≤
            document.addEventListener('keydown', (e) => {
                if (gamePaused && !taskOverlay.classList.contains('hidden')) {
                    const key = e.key.toUpperCase();
                    if (vowels.includes(key)) {
                        handleVowelClick(key);
                    }
                }
            });
            
            console.log("–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã");
        }

        function startGame() {
            console.log("–ù–∞—á–∞–ª–æ –∏–≥—Ä—ã!");
            
            gameActive = true;
            gamePaused = false;
            distance = 0;
            speed = baseSpeed;
            lives = 3;
            score = 0;
            mistakes = 0;
            
            player = new Player();
            snowpiles = [];
            buildings = [];
            lastSnowpileTime = 0;
            lastBuildingTime = 0;
            snowpileInterval = 2000;
            buildingInterval = 4000;
            
            startScreen.classList.add('hidden');
            gameOverScreen.classList.add('hidden');
            taskOverlay.classList.add('hidden');
            gameUI.classList.remove('hidden');
            
            updateLivesDisplay();
            updateDistanceDisplay();
            
            console.log("–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!");
        }

        function updateLivesDisplay() {
            const lifeElements = document.querySelectorAll('.life');
            lifeElements.forEach((life, index) => {
                life.classList.toggle('lost', index >= lives);
            });
        }

        function updateDistanceDisplay() {
            distanceElement.textContent = Math.floor(distance);
        }

        function showTask() {
            const words = Object.keys(wordList);
            const randomWord = words[Math.floor(Math.random() * words.length)];
            currentWord = randomWord;
            currentAnswer = wordList[randomWord];
            
            player.hit();
            
            currentBlanks = [];
            answeredLetters = 0;
            const letters = currentWord.split('');
            
            taskWordElement.innerHTML = '';
            letters.forEach((letter, index) => {
                const span = document.createElement('span');
                span.className = 'letter no-select';
                
                if (letter === '_') {
                    span.classList.add('blank');
                    span.textContent = '?';
                    currentBlanks.push(index);
                } else {
                    span.textContent = letter.toUpperCase();
                }
                
                taskWordElement.appendChild(span);
            });
            
            gamePaused = true;
            taskOverlay.classList.remove('hidden');
        }

        function handleVowelClick(vowel) {
            if (answeredLetters >= currentBlanks.length) return;
            
            const blankIndex = currentBlanks[answeredLetters];
            const answerParts = currentAnswer.split(',');
            const correctLetter = answerParts[answeredLetters]?.toUpperCase();
            
            const letterElements = document.querySelectorAll('.letter');
            const currentLetterElement = letterElements[blankIndex];
            
            if (vowel === correctLetter) {
                currentLetterElement.textContent = vowel;
                currentLetterElement.classList.remove('blank');
                currentLetterElement.classList.add('filled');
                answeredLetters++;
                
                if (answeredLetters >= currentBlanks.length) {
                    score++;
                    setTimeout(() => {
                        taskOverlay.classList.add('hidden');
                        gamePaused = false;
                    }, 500);
                }
            } else {
                mistakes++;
                lives--;
                updateLivesDisplay();
                
                // –≠—Ñ—Ñ–µ–∫—Ç –æ—à–∏–±–∫–∏
                document.body.style.backgroundColor = '#ef4444';
                setTimeout(() => {
                    document.body.style.backgroundColor = '';
                }, 150);
                
                if (lives <= 0) {
                    endGame();
                } else {
                    currentLetterElement.textContent = correctLetter;
                    currentLetterElement.classList.remove('blank');
                    currentLetterElement.style.color = '#10b981';
                    
                    setTimeout(() => {
                        taskOverlay.classList.add('hidden');
                        gamePaused = false;
                    }, 1000);
                }
            }
        }

        function endGame() {
            gameActive = false;
            gamePaused = false;
            taskOverlay.classList.add('hidden');
            gameUI.classList.add('hidden');
            
            finalDistanceElement.textContent = Math.floor(distance) + ' –º';
            wordsCountElement.textContent = score;
            mistakesCountElement.textContent = mistakes;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≥—Ä—É—Å—Ç–Ω–æ–≥–æ –º–∞–ª—å—á–∏–∫–∞ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            if (imagesLoaded && images.playerSad.complete && images.playerSad.naturalHeight !== 0) {
                sadCharacterElement.style.backgroundImage = `url('player_sad.png')`;
            }
            
            setTimeout(() => {
                gameOverScreen.classList.remove('hidden');
            }, 800);
        }

        // –û—Å–Ω–æ–≤–Ω–æ–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop() {
            // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Ñ–æ–Ω
            drawBackground();
            
            // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
            if (gameActive && !gamePaused) {
                player.update();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–∞–Ω–∏—è
                buildings.forEach((building, index) => {
                    building.update();
                    if (building.x < -building.width) {
                        buildings.splice(index, 1);
                    }
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É–≥—Ä–æ–±—ã
                snowpiles.forEach((snowpile, index) => {
                    snowpile.update();
                    
                    if (!snowpile.passed && checkCollision(player.getBounds(), snowpile.getBounds())) {
                        snowpile.passed = true;
                        showTask();
                    }
                    
                    if (snowpile.x < -snowpile.width) {
                        snowpiles.splice(index, 1);
                    }
                });
                
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –æ–±—ä–µ–∫—Ç—ã
                const currentTime = Date.now();
                
                // –ó–¥–∞–Ω–∏—è
                if (currentTime - lastBuildingTime > buildingInterval) {
                    const buildingImages = [images.building1, images.building2, images.building3];
                    const randomImage = buildingImages[Math.floor(Math.random() * buildingImages.length)];
                    buildings.push(new Building(randomImage, canvas.width));
                    lastBuildingTime = currentTime;
                }
                
                // –°—É–≥—Ä–æ–±—ã
                if (currentTime - lastSnowpileTime > snowpileInterval) {
                    snowpiles.push(new Snowpile(canvas.width));
                    lastSnowpileTime = currentTime;
                    
                    // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å
                    snowpileInterval = Math.max(500, snowpileInterval * 0.95);
                    speed = Math.min(maxSpeed, speed + acceleration * distance);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∑–¥–∞–Ω–∏–π
                    buildings.forEach(building => {
                        building.speed = speed * 0.3;
                    });
                }
                
                // –î–∏—Å—Ç–∞–Ω—Ü–∏—è
                distance += speed / 10;
                updateDistanceDisplay();
            }
            
            // –†–∏—Å—É–µ–º –æ–±—ä–µ–∫—Ç—ã
            buildings.forEach(building => building.draw());
            snowpiles.forEach(snowpile => snowpile.draw());
            player.draw();
            
            // –°–Ω–µ–≥–æ–ø–∞–¥
            updateSnowflakes();
            drawSnowflakes();
            
            if (Math.random() < 0.05) {
                createSnowfall();
            }
            
            // –°–ª–µ–¥—É—é—â–∏–π –∫–∞–¥—Ä
            requestAnimationFrame(gameLoop);
        }

        function drawBackground() {
            // –ü—Ä–æ—Å—Ç–æ–π –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0f172a');
            gradient.addColorStop(0.5, '#1e293b');
            gradient.addColorStop(1, '#334155');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –õ—É–Ω–∞/—Å–æ–ª–Ω—Ü–µ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.arc(canvas.width - 100, 100, 40, 0, Math.PI * 2);
            ctx.fill();
            
            // –ó–≤–µ–∑–¥—ã/—Å–Ω–µ–∂–∏–Ω–∫–∏ –Ω–∞ –Ω–µ–±–µ
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            for (let i = 0; i < 30; i++) {
                const x = (i * 37) % canvas.width;
                const y = (i * 23) % 200;
                const size = Math.random() * 2 + 1;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // –ì–æ—Ä—ã
            ctx.fillStyle = '#1e293b';
            ctx.beginPath();
            ctx.moveTo(0, 400);
            for (let x = 0; x <= canvas.width; x += 100) {
                const y = 350 + Math.sin(x / 100) * 30 + Math.cos(x / 50) * 20;
                ctx.lineTo(x, y);
            }
            ctx.lineTo(canvas.width, 400);
            ctx.lineTo(0, 400);
            ctx.fill();
            
            // –°–Ω–µ–∂–Ω–∞—è –∑–µ–º–ª—è
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 350, canvas.width, 150);
            
            // –õ–∏–Ω–∏—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞
            ctx.strokeStyle = '#e2e8f0';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(0, 350);
            ctx.lineTo(canvas.width, 350);
            ctx.stroke();
        }

        function updateSnowflakes() {
            for (let i = snowflakes.length - 1; i >= 0; i--) {
                const flake = snowflakes[i];
                flake.x += flake.vx;
                flake.y += flake.vy;
                flake.life--;
                
                if (flake.life <= 0 || flake.y > canvas.height) {
                    snowflakes.splice(i, 1);
                }
            }
        }

        function drawSnowflakes() {
            snowflakes.forEach(flake => {
                ctx.fillStyle = flake.color;
                ctx.beginPath();
                ctx.arc(flake.x, flake.y, flake.size, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', init);
        
        // –¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω
        if (document.readyState === 'complete') {
            init();
        }
    </script>
</body>
</html>